# 1. 理论回顾

## 1.1. kubernetes的五个组件

##### **master节点的三个组件**

###### **kube-apiserver**

```
整个集群的唯一入口，并提供认证、授权、访问控制、API注册和发现等机制。
```

###### **kube-controller-manager**

```
控制器管理器
负责维护集群的状态，比如故障检测、自动扩展、滚动更新等。保证资源到达期望值。
```

###### **kube-scheduler**

```
调度器
经过策略调度POD到合适的节点上面运行。分别有预选策略和优选策略。
```

##### **node节点的两个组件**

###### **kubelet**

```
在集群节点上运行的代理，kubelet会通过各种机制来确保容器处于运行状态且健康。kubelet不会管理不是由kubernetes创建的容器。kubelet接收POD的期望状态（副本数、镜像、网络等），并调用容器运行环境来实现预期状态。
kubelet会定时汇报节点的状态给apiserver，作为scheduler调度的基础。kubelet会对镜像和容器进行清理，避免不必要的文件资源占用。
```

###### **kube-proxy**

```
kube-proxy是集群中节点上运行的网络代理，是实现service资源功能组件之一。kube-proxy建立了POD网络和集群网络之间的关系。不同node上的service流量转发规则会通过kube-proxy来调用apiserver访问etcd进行规则更新。
service流量调度方式有三种方式：userspace（废弃，性能很差）、iptables（性能差，复杂，即将废弃）、ipvs（性能好，转发方式清晰）。
```

## 1.2. kubernetes的三条网络

![](https://imgconvert.csdnimg.cn/aHR0cDovL25vYWgtcGljLm9zcy1jbi1jaGVuZ2R1LmFsaXl1bmNzLmNvbS9waWMvMjAyMDA0MTYvMDkxMzA0MTM5LnBuZw?x-oss-process=image/format,png)

![在这里插入图片描述](https://img-blog.csdnimg.cn/20201029184243953.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center)

![在这里插入图片描述](https://img-blog.csdnimg.cn/2020081911593913.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center)



###### **节点网络**

实际网络，就是宿主机网络
建议地址段：`10.4.7.0/24`
建议通过不同的IP端,区分不同的业务、机房或数据中心

###### **Pod网络**

实际网络，容器运行的网络
建议`172.7.21.0/24` ,并建议POD网段与节点IP绑定
如: 节点IP为`10.4.7.21`，则POD网络为`172.7.21.0/24`

###### **Service 网络**

虚拟网络，也叫集群网络(cluster server),用于内部集群间通信
构建于POD网络之上, 主要是解决服务发现和负载均衡
通过kube-proxy连接POD网络和service网络
建议地址段为：`192.168.0.0/16`



# 2. 集群架构

|     **主机名**     | **IP地址** |
| :----------------: | :--------: |
| hdss7-11.host.com  | 10.4.7.11  |
| hdss7-12.host.com  | 10.4.7.12  |
| hdss7-21.host.com  | 10.4.7.21  |
| hdss7-22.host.com  | 10.4.7.22  |
| hdss7-200.host.com | 10.4.7.200 |

# 3. 基础环境准备

## 3.1. 准备虚拟机(这里我用的vmware)

![在这里插入图片描述](https://img-blog.csdnimg.cn/20201030170851198.png#pic_center)





##### **注意事项**

###### **VMnet1和VMnet8网卡在windows上不存在的解决方案**

![在这里插入图片描述](https://img-blog.csdnimg.cn/20201030172033665.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center)

![在这里插入图片描述](https://img-blog.csdnimg.cn/20201030172346102.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center)



###### **网络的设置（VMnet8 网桥、网关）**

![在这里插入图片描述](https://img-blog.csdnimg.cn/20201030173042252.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center)

![在这里插入图片描述](https://img-blog.csdnimg.cn/20201030174001731.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center)



###### **虚拟机的参数**

![在这里插入图片描述](https://img-blog.csdnimg.cn/20201030174133952.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center)

## 3.2. 设置主机名

```bash
hostnamectl set-hostname hdss7-xx.host.com
```

